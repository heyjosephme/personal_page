---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero";
import { RecentBlogPosts } from "@/components/RecentBlogPosts";
import LandingPage from "@/LandingPage.tsx";
import { getCollection } from "astro:content";
import { enhanceBlogPosts } from "@/lib/blog-helpers";

const title = "Joseph - Full-stack Developer in Tokyo";
const description =
  "I build web applications that solve real problems. Full-stack developer in Tokyo specializing in Rails 8 + Hotwire, TypeScript, and React.";

// Get recent blog posts
const allPosts = await getCollection("blog");
const posts = import.meta.env.DEV
  ? allPosts
  : allPosts.filter((post) => !post.data.draft);
const enhancedPosts = await enhanceBlogPosts(posts);
const sortedPosts = enhancedPosts.sort((a, b) => {
  return (
    new Date(b.timestamps.createdAt).getTime() -
    new Date(a.timestamps.createdAt).getTime()
  );
});
---

<Layout title={title} description={description}>
  <div class="relative overflow-hidden">
    <section class="container px-4 py-16 mx-auto relative z-10">
      <div class="w-full mx-auto text-center md:w-11/12 xl:w-9/12 mb-12">
        <Hero client:load />
      </div>
    </section>

    <RecentBlogPosts posts={sortedPosts} maxPosts={5} client:load />

    <LandingPage />
  </div>
</Layout>
